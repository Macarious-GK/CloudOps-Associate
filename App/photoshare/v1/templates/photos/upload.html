{% load static %}

<!DOCTYPE html>
<html>
<head>
    <title>Photo Upload & Presign</title>
</head>
<body>
    <h2>Upload Photo</h2>

    <form id="uploadForm">
        {% csrf_token %}
        <input type="file" id="photoInput" name="photo" accept="image/*" required />
        <button type="submit">Upload</button>
    </form>

    <hr>

    <h2>Get Presigned URL</h2>
    <form id="presignForm">
        {% csrf_token %}
        <input type="text" id="keyInput" placeholder="Enter S3 key" required />
        <button type="submit">Get Presigned URL</button>
    </form>

    <h3>Result</h3>
    <img id="preview" style="max-width:400px; display:none;" />
    <br><br>
    <a id="downloadLink" style="display:none;" target="_blank">Download Photo</a>

 <!-- NEW: CloudWatch Log Test -->
    <h2>CloudWatch Logs Test</h2>
    <button id="sendLogBtn">Send Log to CloudWatch</button>
    <p id="logStatus"></p>

    <h3>Result</h3>
    <img id="preview" style="max-width:400px; display:none;" />
    <br><br>
    <a id="downloadLink" style="display:none;" target="_blank">Download Photo</a>

    <script src="{% static 'photos/upload.js' %}"></script>

    <!-- NEW: Inline JS for log button -->
    <script>
        document.getElementById("sendLogBtn").addEventListener("click", function () {
            fetch("/api/logs", {
                method: "GET",
                headers: {
                    "X-Requested-With": "XMLHttpRequest"
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("logStatus").innerText =
                    "✅ Log sent to CloudWatch!";
                console.log("CloudWatch response:", data);
            })
            .catch(error => {
                document.getElementById("logStatus").innerText =
                    "❌ Failed to send log.";
                console.error("Error:", error);
            });
        });
    </script>
    </body>
</html>
